<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Financial Projection</title>
  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="style.css?v=2" />
</head>

<body class="bg-gray-50 text-gray-800 font-sans">

  <div class="max-w-6xl mx-auto p-4" style="margin-bottom: 80px;">

      <!-- Header -->
    <header class="text-center mb-6">
      <h1 class="text-3xl font-bold text-indigo-700">Financial Projection</h1>
      <p class="text-gray-600">A work in progress - not financial advice - might have bugs</p>
      <p class="text-gray-600">No data leaves your device - everything is stored in your local storage</p>
    </header>

    <!-- Main container: 2 columns on desktop, stacked on mobile -->
    <div class="flex flex-col md:flex-row gap-6">


      
      <div class="w-full md:w-1/3 space-y-4">

        <!-- Personal Info Group -->
        <details class="bg-white rounded-xl shadow p-4 w-full">
          <summary class="cursor-pointer font-semibold text-indigo-600 text-lg">Personal Info</summary>
          <div class="mt-2 space-y-4">
            <div>
              <label class="block text-lg font-medium" for="ageInput">Current Age
              </label>
              <input type="number" id="ageInput"
                class="mt-1 w-full rounded-lg border-gray-300 shadow-sm p-3 text-lg focus:border-indigo-500 focus:ring focus:ring-indigo-200" />
            </div>
            <label class="inline-flex items-center space-x-2">
              <input type="checkbox" id="spouseCheckbox"
                class="h-5 w-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
              <span class="text-lg font-medium">Include Spouse?</span>
              <p class="text-sm text-gray-500 mt-1">Do you want to include spouse pension/savings in the simualation. The simulation will run assuming both people survive until your chosen simulation end age</p>
            </label>
            <div class="spouse">
              <label class="block text-lg font-medium" for="spouseAgeInput">Spouse Current Age</label>
              <input type="number" id="spouseAgeInput"
                class="mt-1 w-full rounded-lg border-gray-300 shadow-sm p-3 text-lg focus:border-indigo-500 focus:ring focus:ring-indigo-200" />
            </div>
          </div>
            <div>
              <label class="block text-lg font-medium" for="projectToAgeInput">Simulation end age</label>
              <input type="number" id="projectToAgeInput"
                class="mt-1 w-full rounded-lg border-gray-300 shadow-sm p-3 text-lg focus:border-indigo-500 focus:ring focus:ring-indigo-200" />
              <p class="text-sm text-gray-500 mt-1">This should be the age at which you want to simulate surviving to (for drawdown simulation) or the age at which you want to simulate investment growth to (no drawdown simulation)</p>
            </div>
        <div>
          <label class="inline-flex items-center space-x-2">
            <input type="checkbox" id="modelDrawdownCheckbox"
              class="h-5 w-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
            <span class="text-lg font-medium">Model retirement drawdown?</span>
            <p class="block text-sm">Models flexible drawdown from investments after your chosen retirement age</p>
          </label>
        </div>

          </details>


       <div id="investmentsContainer"></div>
       <div class="spouse" id="spouseInvestmentsContainer"></div>

        <script>
          async function loadSection(filename, containerId) {
            const res = await fetch(filename);
            const html = await res.text();
            document.getElementById(containerId).insertAdjacentHTML('beforeend', html);
          }

          // Load each account section
          loadSection('investments.html', 'investmentsContainer');
          loadSection('spouseInvestments.html', 'spouseInvestmentsContainer');
          
        </script>

        <!-- Assumed Growth Group -->
        <details class="bg-white rounded-xl shadow p-4 w-full">
          <summary class="cursor-pointer font-semibold text-indigo-600 text-lg">Growth Rates</summary>
              <p class="block text-sm">The simulation will always use a constant growth percentage for investments during your accumulation phase before drawdown.  
                Then you can choose to simulate historic growth (assuming global or US stocks) or constant growth during drawdown.</p>
          <div class="mt-2 space-y-4">
            <div>
              <label class="block text-lg font-medium" for="investmentPercentageInput">Investment Growth %</label>
              <input type="number" id="investmentPercentageInput"
                class="mt-1 w-full rounded-lg border-gray-300 shadow-sm p-3 text-lg focus:border-indigo-500 focus:ring focus:ring-indigo-200" />
              <p class="block text-sm"> This is the expected growth rate <em>after inflation</em> for your investments
                (pension/ISA/GIA...)</p>
            </div>
            <!-- <div>
              <label class="inline-flex items-center space-x-2">
                <input type="checkbox" id="historicSimulationCheckbox"
                  class="h-5 w-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                <span class="text-lg font-medium">Historic Simulation</span>
              </label>
            </div> -->

            <div>
<fieldset class="space-y-2">
  <legend class="text-lg font-medium mb-1">Simulation Type (During drawdown)</legend>
  
  <label class="inline-flex items-center space-x-2">
    <input type="radio" name="simulationType" id="historicSimulationRadio"
           value="historicSimulation"
           class="h-5 w-5 text-indigo-600 border-gray-300 focus:ring-indigo-500">
    <span>Historic (Global)</span>
  </label>

  <label class="inline-flex items-center space-x-2">
    <input type="radio" name="simulationType" id="historicUSSimulationRadio"
           value="historicUSSimulation"
           class="h-5 w-5 text-indigo-600 border-gray-300 focus:ring-indigo-500">
    <span>Historic (US)</span>
  </label>

  <label class="inline-flex items-center space-x-2">
    <input type="radio" name="simulationType" id="constantRateGrowthRadio"
           value="constant"
           class="h-5 w-5 text-indigo-600 border-gray-300 focus:ring-indigo-500">
    <span>Constant Rate Growth</span>
  </label>
</fieldset>
</div>


            <div>
              <label class="block text-lg font-medium" for="savingsPercentageInput">Cash Savings Growth %</label>
              <input type="number" id="savingsPercentageInput"
                class="mt-1 w-full rounded-lg border-gray-300 shadow-sm p-3 text-lg focus:border-indigo-500 focus:ring focus:ring-indigo-200" />
              <p class="block text-sm"> This is the expected growth rate <em>after inflation</em> for your cash savings
              </p>
            </div>
          </div>
        </details>


        <!-- Retirement / Drawdown Group 
        <details id="drawdownGroup" class="bg-white rounded-xl shadow p-4 w-full">
          <summary class="cursor-pointer font-semibold text-indigo-600 text-lg">Retirement Drawdown</summary>
          <div class="mt-2 space-y-4">
            <div>
              <label class="block text-lg font-medium" for="retirementAgeInput">Retirement Age</label>
              <input type="number" id="retirementAgeInput"
                class="mt-1 w-full rounded-lg border-gray-300 shadow-sm p-3 text-lg focus:border-indigo-500 focus:ring focus:ring-indigo-200" />
            </div>
            <div>
              <label class="block text-lg font-medium" for="annualDrawdownUnder75Input">Annual Drawdown (Under
                75)</label>
              <input type="number" id="annualDrawdownUnder75Input"
                class="mt-1 w-full rounded-lg border-gray-300 shadow-sm p-3 text-lg focus:border-indigo-500 focus:ring focus:ring-indigo-200" />
              <p class="block text-sm">When you might want to spend a bit more</p>
            </div>
            <div>
              <label class="block text-lg font-medium" for="annualDrawdown75to89Input">Annual Drawdown (75-89)</label>
              <input type="number" id="annualDrawdown75to89Input"
                class="mt-1 w-full rounded-lg border-gray-300 shadow-sm p-3 text-lg focus:border-indigo-500 focus:ring focus:ring-indigo-200" />
              <p class="block text-sm">When you might want to spend a bit less</p>
            </div>
            <div>
              <label class="block text-lg font-medium" for="annualDrawdown90PlusInput">Annual Drawdown (90 or over)</label>
              <input type="number" id="annualDrawdown90PlusInput"
                class="mt-1 w-full rounded-lg border-gray-300 shadow-sm p-3 text-lg focus:border-indigo-500 focus:ring focus:ring-indigo-200" />
              <p class="block text-sm">When you might want to spend a bit more for care</p>
            </div>
            <div>
              <label class="block text-lg font-medium" for="statePensionInput">State Pension</label>
              <input type="number" id="statePensionInput"
                class="mt-1 w-full rounded-lg border-gray-300 shadow-sm p-3 text-lg focus:border-indigo-500 focus:ring focus:ring-indigo-200" />
            </div>
            <div>
              <label class="block text-lg font-medium" for="statePensionAgeInput">State Pension Age</label>
              <input type="number" id="statePensionAgeInput"
                class="mt-1 w-full rounded-lg border-gray-300 shadow-sm p-3 text-lg focus:border-indigo-500 focus:ring focus:ring-indigo-200" />
            </div>
            <div class="spouse">
              <label class="block text-lg font-medium spouse" for="spouseStatePensionInput">Spouse State Pension</label>
              <input type="number" id="spouseStatePensionInput"
                class="mt-1 w-full rounded-lg border-gray-300 shadow-sm p-3 text-lg focus:border-indigo-500 focus:ring focus:ring-indigo-200" />
            </div>
            <div class="spouse">
              <label class="block text-lg font-medium spouse" for="spouseStatePensionAgeInput">Spouse State Pension Age</label>
              <input type="number" id="spouseStatePensionAgeInput"
                class="mt-1 w-full rounded-lg border-gray-300 shadow-sm p-3 text-lg focus:border-indigo-500 focus:ring focus:ring-indigo-200" />
            </div>

            <div>
              <label class="block text-lg font-medium" for="definedBenefitPensionInput">Defined Benefit Pension</label>
              <input type="number" id="definedBenefitPensionInput"
                class="mt-1 w-full rounded-lg border-gray-300 shadow-sm p-3 text-lg focus:border-indigo-500 focus:ring focus:ring-indigo-200" />
            </div>
            <div>
              <label class="block text-lg font-medium" for="definedBenefitPensionAgeInput">Defined Benefit Pension
                Age</label>
              <input type="number" id="definedBenefitPensionAgeInput"
                class="mt-1 w-full rounded-lg border-gray-300 shadow-sm p-3 text-lg focus:border-indigo-500 focus:ring focus:ring-indigo-200" />
            </div>

                        <div class="spouse">
              <label class="block text-lg font-medium spouse" for="spouseDefinedBenefitPensionInput">Spouse Defined Benefit Pension</label>
              <input type="number" id="spouseDefinedBenefitPensionInput"
                class="mt-1 w-full rounded-lg border-gray-300 shadow-sm p-3 text-lg focus:border-indigo-500 focus:ring focus:ring-indigo-200" />
            </div>
            <div class="spouse">
              <label class="block text-lg font-medium spouse" for="spouseDefinedBenefitPensionAgeInput">Spouse Defined Benefit Pension
                Age</label>
              <input type="number" id="spouseDefinedBenefitPensionAgeInput"
                class="mt-1 w-full rounded-lg border-gray-300 shadow-sm p-3 text-lg focus:border-indigo-500 focus:ring focus:ring-indigo-200" />
            </div>

            <div class="spouse">
              <label class="block text-lg font-medium spouse" for="deathAgeInput">Simulate Death Age</label>
              <input type="number" id="deathAgeInput"
                class="mt-1 w-full rounded-lg border-gray-300 shadow-sm p-3 text-lg focus:border-indigo-500 focus:ring focus:ring-indigo-200" />
            </div>

            <div class="spouse">
              <label class="block text-lg font-medium spouse" for="spouseDeathAgeInput">Simulate Spouse Death Age</label>
              <input type="number" id="spouseDeathAgeInput"
                class="mt-1 w-full rounded-lg border-gray-300 shadow-sm p-3 text-lg focus:border-indigo-500 focus:ring focus:ring-indigo-200" />
            </div>


          </div>
        </details>-->

<!-- Retirement / Drawdown Group -->
<details id="drawdownGroup" class="bg-white rounded-xl shadow p-4 w-full">
  <summary class="cursor-pointer font-semibold text-indigo-600 text-lg">Retirement Drawdown</summary>
  
  <div class="mt-4 space-y-6">

    <!-- Retirement Age -->
    <div>
      <label class="block text-lg font-medium" for="retirementAgeInput">Retirement Age</label>
      <input type="number" id="retirementAgeInput"
        class="mt-1 w-full rounded-lg border-gray-300 shadow-sm p-3 text-lg focus:border-indigo-500 focus:ring focus:ring-indigo-200" />
    </div>

    <!-- Drawdown by Age Groups -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div>
        <label class="block text-lg font-medium" for="annualDrawdownUnder75Input">Annual Drawdown (Under 75)</label>
        <input type="number" id="annualDrawdownUnder75Input"
          class="mt-1 w-full rounded-lg border-gray-300 shadow-sm p-3 text-lg focus:border-indigo-500 focus:ring focus:ring-indigo-200" />
        <p class="text-sm mt-1">When you might want to spend a bit more</p>
      </div>
      <div>
        <label class="block text-lg font-medium" for="annualDrawdown75to89Input">Annual Drawdown (75-89)</label>
        <input type="number" id="annualDrawdown75to89Input"
          class="mt-1 w-full rounded-lg border-gray-300 shadow-sm p-3 text-lg focus:border-indigo-500 focus:ring focus:ring-indigo-200" />
        <p class="text-sm mt-1">When you might want to spend a bit less</p>
      </div>
      <div>
        <label class="block text-lg font-medium" for="annualDrawdown90PlusInput">Annual Drawdown (90+)</label>
        <input type="number" id="annualDrawdown90PlusInput"
          class="mt-1 w-full rounded-lg border-gray-300 shadow-sm p-3 text-lg focus:border-indigo-500 focus:ring focus:ring-indigo-200" />
        <p class="text-sm mt-1">When you might want to spend more for care</p>
      </div>
    </div>

    <!-- State Pensions -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 spouse-option">
      <div>
        <h3 class="text-lg font-semibold text-indigo-600 mb-2 md:block">You</h3>
        <label class="block text-lg font-medium" for="statePensionInput">Your State Pension</label>
        <input type="number" id="statePensionInput"
          class="mt-1 w-full rounded-lg border-gray-300 shadow-sm p-3 text-lg focus:border-indigo-500 focus:ring focus:ring-indigo-200" />
      </div>
      <div class="spouse">
        <h3 class="text-lg font-semibold text-indigo-600 mb-2 hidden md:block">Spouse</h3>
        <label class="block text-lg font-medium" for="spouseStatePensionInput">Spouse State Pension</label>
        <input type="number" id="spouseStatePensionInput"
          class="mt-1 w-full rounded-lg border-gray-300 shadow-sm p-3 text-lg focus:border-indigo-500 focus:ring focus:ring-indigo-200" />
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 spouse-option">
      <div>
        <label class="block text-lg font-medium" for="statePensionAgeInput">Your State Pension Age</label>
        <input type="number" id="statePensionAgeInput"
          class="mt-1 w-full rounded-lg border-gray-300 shadow-sm p-3 text-lg focus:border-indigo-500 focus:ring focus:ring-indigo-200" />
      </div>
      <div class="spouse">
        <label class="block text-lg font-medium" for="spouseStatePensionAgeInput">Spouse State Pension Age</label>
        <input type="number" id="spouseStatePensionAgeInput"
          class="mt-1 w-full rounded-lg border-gray-300 shadow-sm p-3 text-lg focus:border-indigo-500 focus:ring focus:ring-indigo-200" />
      </div>
    </div>

    <!-- Defined Benefit Pensions -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 spouse-option">
      <div>
        <label class="block text-lg font-medium" for="definedBenefitPensionInput">Your Defined Benefit Pension</label>
        <input type="number" id="definedBenefitPensionInput"
          class="mt-1 w-full rounded-lg border-gray-300 shadow-sm p-3 text-lg focus:border-indigo-500 focus:ring focus:ring-indigo-200" />
      </div>
      <div class="spouse">
        <label class="block text-lg font-medium" for="spouseDefinedBenefitPensionInput">Spouse Defined Benefit Pension</label>
        <input type="number" id="spouseDefinedBenefitPensionInput"
          class="mt-1 w-full rounded-lg border-gray-300 shadow-sm p-3 text-lg focus:border-indigo-500 focus:ring focus:ring-indigo-200" />
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 spouse-option">
      <div>
        <label class="block text-lg font-medium" for="definedBenefitPensionAgeInput">Your Defined Benefit Pension Age</label>
        <input type="number" id="definedBenefitPensionAgeInput"
          class="mt-1 w-full rounded-lg border-gray-300 shadow-sm p-3 text-lg focus:border-indigo-500 focus:ring focus:ring-indigo-200" />
      </div>
      <div class="spouse">
        <label class="block text-lg font-medium" for="spouseDefinedBenefitPensionAgeInput">Spouse Defined Benefit Pension Age</label>
        <input type="number" id="spouseDefinedBenefitPensionAgeInput"
          class="mt-1 w-full rounded-lg border-gray-300 shadow-sm p-3 text-lg focus:border-indigo-500 focus:ring focus:ring-indigo-200" />
      </div>
    </div>

    <!-- Death Ages -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 spouse spouse-option">
      <div>
        <label class="block text-lg font-medium" for="deathAgeInput">Your Simulated Death Age</label>
        <input type="number" id="deathAgeInput"
          class="mt-1 w-full rounded-lg border-gray-300 shadow-sm p-3 text-lg focus:border-indigo-500 focus:ring focus:ring-indigo-200" />
      </div>
      <div class="spouse">
        <label class="block text-lg font-medium" for="spouseDeathAgeInput">Spouse Simulated Death Age</label>
        <input type="number" id="spouseDeathAgeInput"
          class="mt-1 w-full rounded-lg border-gray-300 shadow-sm p-3 text-lg focus:border-indigo-500 focus:ring focus:ring-indigo-200" />
      </div>
    </div>

  </div>
</details>



        <!-- Calculate Button 
        <div class="mt-4">
          <button id="calculateBtn" type="button"
            class="w-full bg-indigo-600 text-white rounded-lg py-3 text-lg hover:bg-indigo-700 transition">
            Calculate
          </button>
          <p class="block text-sm">The graphs should update on their own but this will also update them</p>
        </div>
        -->




      </div>


    <!-- Right column -->
  <div class="md:w-2/3">



    <div class="sticky top-4 bg-white rounded-xl shadow p-4">

      <div id="chartContainer" class="w-full h-96">
        <canvas id="myChart"></canvas>
      </div>


         <details id="scenarios" class="bg-white rounded-xl shadow p-4 w-full mb-6">
          <summary class="cursor-pointer font-semibold text-indigo-600 text-lg">Alternative Scenarios (<span class="currentScenario">A</span>)</summary>
          <p class="mt-2 text-gray-800">You are currently editing Scenario <span class="currentScenario">A</span></p>
        <div class="flex space-x-4 items-center">
          <label class="flex items-center space-x-2 cursor-pointer">
            <input type="radio" name="scenario" value="A" checked
              class="w-5 h-5 text-blue-600 border-gray-300 focus:ring-blue-500">
            <span class="text-gray-700 font-medium">Scenario A</span>
          </label>

          <label class="flex items-center space-x-2 cursor-pointer">
            <input type="radio" name="scenario" value="B"
              class="w-5 h-5 text-blue-600 border-gray-300 focus:ring-blue-500">
            <span class="text-gray-700 font-medium">Scenario B</span>
          </label>
        </div>

        <div class="mt-4">
          <button id="duplicateAtoBBtn" type="button"
            class="w-full bg-indigo-600 text-white rounded-lg py-3 text-lg hover:bg-indigo-700 transition">
            Duplicate A to B
          </button>
          <p class="block text-sm">Copies all setting from your scenario A to scenario B. You can then make changes to
            scenario B and use the radio button above to switch between them to see the impact.</p>
        </div>
</details>


<div id="fvContainer" class="bg-white rounded-xl shadow p-4 w-full grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
  <div id="percentageSuccess" class="font-medium text-gray-800 text-sm md:text-base"></div>
  <div id="medianFinalValue" class="font-medium text-gray-800 text-sm md:text-base">£${fmt(min)}</div>
</div>



      <div id="statsGroup" class="font-medium text-gray-800 text-sm md:text-base">
        <div id="finalValue"></div>

        <div id="fvContainer" class="w-full p-4 bg-white rounded-xl shadow">
          <div id="fvheading" class="text-center"></div>
          <div id="fvbar" class="relative w-full h-2 bg-gray-200 rounded-full mt-3">
            <div id="fvrange" class="absolute h-2 bg-indigo-400 rounded-full"></div>
            <div id="fvmedian" class="absolute h-3 w-3 bg-indigo-800 rounded-full -top-0.5"></div>
          </div>
        </div>

        <div id="statsContainer" class="mt-6"></div>
      </div>
    </div>

</div>

</div>

<div id="withdrawalsPage" class="p-6">

<div class="flex items-center gap-3 mb-6">
  <label for="indexSelect" class="text-gray-700 font-medium">Select Index:</label>
  
  <select id="indexSelect" class="border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
    <!-- Options will be added dynamically -->
  </select>

  <button id="indexButton" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition">
    Apply
  </button>
</div>


<div class="overflow-x-auto space-y-10">
  <!-- Withdrawals Chart Section -->
  <div>
    <h2 class="text-2xl font-semibold text-gray-800 mb-2">
      Withdrawals - Simulation Line
    </h2>
    <p class="text-gray-600 mb-4">
      The withdrawal strategy is very basic.  First use state pension and DB pension, then try to take the remainder from defined contribution pension.  Any remainder will be taken from main cash, then ISA, then GIA. 
    </p>

  <canvas id="withdrawalsChart" class="mb-6"></canvas>
</div>

<div class="overflow-x-auto space-y-10">
  <!-- Withdrawals Chart Section -->
  <div>
    <h2 class="text-2xl font-semibold text-gray-800 mb-2">
      Drawdown and Tax - Simulation Line
    </h2>
    <p class="text-gray-600 mb-4">
      The withdrawal strategy is very very basic, but hopfully it gives an idea.  We try to take the full drawdown amount from pension, then cash, then ISA, then GIA.  If there are any tax implications then we try to drawdown the tax amount from cash and ISA. 
    </p>

  <canvas id="taxChart" class="mb-6"></canvas>
</div>

<div class="overflow-x-auto space-y-10">
  <!-- Withdrawals Chart Section -->
  <div>
    <h2 class="text-2xl font-semibold text-gray-800 mb-2">
      Total Assets - for the selected simulation
    </h2>
    <p class="text-gray-600 mb-4">
      This shows the accumulation and drawdown of the assets over the course of the selected simulation.  
    </p>

  <h2 class="text-2xl font-semibold mb-4">Total Assets - For the selected simulation</h2>
  <canvas id="assetsChart"></canvas>
</div>

  <h2 class="text-2xl font-semibold mb-4">Year by year breakdown - For the selected simulation</h2>
  <div id="withdrawalsTableContainer"></div>

</div>

  <script src='https://storage.ko-fi.com/cdn/scripts/overlay-widget.js'></script>
  <script>
    kofiWidgetOverlay.draw('captaincaaaaveman', {
      'type': 'floating-chat',
      'floating-chat.donateButton.text': 'Support me',
      'floating-chat.donateButton.background-color': '#ff38b8',
      'floating-chat.donateButton.text-color': '#fff'
    });
  </script>

  <!-- Existing JS -->
  <script type="module" src="js/main.js"></script>
</body>


</html>
